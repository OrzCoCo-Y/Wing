(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-04ec3c10","chunk-40704c2c","chunk-2d209152"],{1276:function(e,t,a){"use strict";var n=a("d784"),r=a("44e7"),i=a("825a"),s=a("1d80"),o=a("4840"),l=a("8aa5"),c=a("50c4"),u=a("14c3"),d=a("9263"),f=a("d039"),h=[].push,g=Math.min,p=4294967295,v=!f((function(){return!RegExp(p,"y")}));n("split",2,(function(e,t,a){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,a){var n=String(s(this)),i=void 0===a?p:a>>>0;if(0===i)return[];if(void 0===e)return[n];if(!r(e))return t.call(n,e,i);var o,l,c,u=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),g=0,v=new RegExp(e.source,f+"g");while(o=d.call(v,n)){if(l=v.lastIndex,l>g&&(u.push(n.slice(g,o.index)),o.length>1&&o.index<n.length&&h.apply(u,o.slice(1)),c=o[0].length,g=l,u.length>=i))break;v.lastIndex===o.index&&v.lastIndex++}return g===n.length?!c&&v.test("")||u.push(""):u.push(n.slice(g)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,a){return void 0===e&&0===a?[]:t.call(this,e,a)}:t,[function(t,a){var r=s(this),i=void 0==t?void 0:t[e];return void 0!==i?i.call(t,r,a):n.call(String(r),t,a)},function(e,r){var s=a(n,e,this,r,n!==t);if(s.done)return s.value;var d=i(e),f=String(this),h=o(d,RegExp),m=d.unicode,b=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(v?"y":"g"),x=new h(v?d:"^(?:"+d.source+")",b),w=void 0===r?p:r>>>0;if(0===w)return[];if(0===f.length)return null===u(x,f)?[f]:[];var y=0,k=0,C=[];while(k<f.length){x.lastIndex=v?k:0;var _,R=u(x,v?f:f.slice(k));if(null===R||(_=g(c(x.lastIndex+(v?0:k)),f.length))===y)k=l(f,k,m);else{if(C.push(f.slice(y,k)),C.length===w)return C;for(var $=1;$<=R.length-1;$++)if(C.push(R[$]),C.length===w)return C;k=y=_}}return C.push(f.slice(y)),C}]}),!v)},"3efd":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("d2-container",[a("template",{slot:"header"},[a("div",[a("el-button",{attrs:{icon:"el-icon-back"},on:{click:function(t){return e.back()}}},[e._v("返回")]),a("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.save()}}},[e._v("保存")]),a("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:function(t){return e.add()}}},[e._v("新增")]),a("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定要删除吗？"},on:{onConfirm:function(t){return e.remove()}}},[a("el-button",{attrs:{slot:"reference",type:"danger"},slot:"reference"},[e._v("删除")])],1)],1)]),a("div",[a("el-row",[a("el-col",{attrs:{span:5}},[a("div",{staticStyle:{height:"640px"}},[a("vxe-table",{ref:"config",staticClass:"mytable-scrollbar",attrs:{border:"",resizable:"",height:"100%",size:"medium",align:"left","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","auto-resize":"","keep-source":"",stripe:"","edit-config":{trigger:"click",mode:"cell"},loading:e.loading,data:e.configData,"mouse-config":{selected:!0}},on:{"current-change":e.rowChange}},[a("vxe-column",{attrs:{field:"key",title:"配置Key","edit-render":{autofocus:".vxe-input--inner"}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:n.key,callback:function(t){e.$set(n,"key",t)},expression:"row.key"}})]}}])})],1)],1)]),a("el-col",{attrs:{span:19}},[a("div",{staticStyle:{"margin-left":"20px"}},[a("el-input",{attrs:{type:"textarea",rows:30,placeholder:e.placeholder,disabled:e.disabled},model:{value:e.currentRow.value,callback:function(t){e.$set(e.currentRow,"value",t)},expression:"currentRow.value"}})],1)])],1)],1)],2)},r=[],i=(a("c740"),a("a434"),a("ac1f"),a("8a79"),a("841c"),a("1276"),a("96cf"),a("1da1")),s={name:"service-config",data:function(){return{saveLoading:!1,loading:!1,services:[],disabled:!0,configData:[],currentRow:{key:"",value:""},placeholder:"请输入配置Value",configKey:"",id:1}},mounted:function(){var e=this;this.Bus.on("serviceNameToConfig",function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.configKey=a,t.next=3,e.search();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},created:function(){},beforeDestroy:function(){this.Bus.off("serviceNameToConfig")},methods:{rowChange:function(e){e.row.key.endsWith("/")?(this.placeholder="该配置Key是目录，不允许编辑配置Value",this.disabled=!0):(this.placeholder="请输入配置内容",this.disabled=!1),this.currentRow=e.row},save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.configData.length)){t.next=13;break}if(n=e.configData[a],n.key){t.next=6;break}return e.$message.error("配置key必填"),t.abrupt("return");case 6:if(r=n.key.split("/"),r[0]===e.configKey){t.next=10;break}return e.$message.error("配置key不合法"),t.abrupt("return");case 10:a++,t.next=1;break;case 13:return e.saveLoading=!0,t.next=16,e.$api.CONFIG_SAVE(e.configData).catch((function(t){e.saveLoading=!1}));case 16:if(i=t.sent,e.saveLoading=!1,!i){t.next=22;break}return e.$notify({title:"成功",message:"保存成功",type:"success",duration:2e3}),t.next=22,e.search();case 22:case"end":return t.stop()}}),t)})))()},search:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$api.CONFIG_GET({key:e.configKey});case 3:if(a=t.sent,e.loading=!1,console.log("服务配置",a),a){t.next=8;break}return t.abrupt("return");case 8:for(n in e.configData=[],a)e.configData.push({key:n,value:a[n]});e.configData.length>0&&(e.$refs.config.setCurrentRow(e.configData[0]),e.rowChange({row:e.configData[0]}));case 11:case"end":return t.stop()}}),t)})))()},add:function(){this.id++,this.configData.push({id:this.id,key:"",value:""})},remove:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.currentRow.id){t.next=3;break}return e.configData.splice(e.configData.findIndex((function(t){return t.id===e.currentRow.id})),1),t.abrupt("return");case 3:return t.next=5,e.$api.CONFIG_DELETE({key:e.currentRow.key});case 5:return a=t.sent,a?e.$message({type:"success",message:"删除成功！"}):e.$message.error("删除失败，请稍后重试！"),t.next=9,e.search();case 9:case"end":return t.stop()}}),t)})))()},back:function(){var e=this;this.$confirm("您确定要返回吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$emit("show",0)})).catch((function(){}))}}},o=s,l=a("2877"),c=Object(l["a"])(o,n,r,!1,null,"0ec59b48",null);t["default"]=c.exports},"44e7":function(e,t,a){var n=a("861d"),r=a("c6b6"),i=a("b622"),s=i("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[s])?!!t:"RegExp"==r(e))}},"5a34":function(e,t,a){var n=a("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},"8a79":function(e,t,a){"use strict";var n=a("23e7"),r=a("06cf").f,i=a("50c4"),s=a("5a34"),o=a("1d80"),l=a("ab13"),c=a("c430"),u="".endsWith,d=Math.min,f=l("endsWith"),h=!c&&!f&&!!function(){var e=r(String.prototype,"endsWith");return e&&!e.writable}();n({target:"String",proto:!0,forced:!h&&!f},{endsWith:function(e){var t=String(o(this));s(e);var a=arguments.length>1?arguments[1]:void 0,n=i(t.length),r=void 0===a?n:d(i(a),n),l=String(e);return u?u.call(t,l,r):t.slice(r-l.length,r)===l}})},a816:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("d2-container",[a("template",{slot:"header"},[a("div",[a("el-input",{staticClass:"search",staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入服务名称"},on:{change:e.search},model:{value:e.pageModel.data.name,callback:function(t){e.$set(e.pageModel.data,"name",t)},expression:"pageModel.data.name"}}),a("el-select",{staticClass:"search",attrs:{placeholder:"请选择健康状态",clearable:""},on:{change:e.search},model:{value:e.pageModel.data.status,callback:function(t){e.$set(e.pageModel.data,"status",t)},expression:"pageModel.data.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("el-select",{staticClass:"search",attrs:{placeholder:"请选择服务类别",clearable:""},on:{change:e.search},model:{value:e.pageModel.data.serviceType,callback:function(t){e.$set(e.pageModel.data,"serviceType",t)},expression:"pageModel.data.serviceType"}},e._l(e.serviceOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("el-select",{staticClass:"search",attrs:{placeholder:"请选择负载均衡",clearable:""},on:{change:e.search},model:{value:e.pageModel.data.loadBalancer,callback:function(t){e.$set(e.pageModel.data,"loadBalancer",t)},expression:"pageModel.data.loadBalancer"}},e._l(e.loadBalancerOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("el-button",{staticClass:"search",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return t.preventDefault(),e.search(t)}}},[e._v("查询")])],1)]),a("div",{staticClass:"table-container"},[a("vxe-table",{ref:"xTable",staticClass:"mytable-scrollbar",attrs:{border:"",resizable:"",height:"100%",size:"medium",align:"center","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","auto-resize":"","keep-source":"",stripe:"","edit-config":{trigger:"click",mode:"row",showStatus:!0},loading:e.loading,data:e.services.items,"mouse-config":{selected:!0}}},[a("vxe-column",{attrs:{type:"seq",width:"60"}}),a("vxe-column",{attrs:{field:"name",title:"服务名称",sortable:""}}),a("vxe-column",{attrs:{field:"address",title:"服务地址",sortable:""}}),a("vxe-column",{attrs:{field:"status",title:"健康状态",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[0==n.status?a("el-tag",{attrs:{type:"success"}},[e._v("健康")]):1==n.status?a("el-tag",{attrs:{type:"warning"}},[e._v("警告")]):2==n.status?a("el-tag",{attrs:{type:"danger"}},[e._v("死亡")]):3==n.status?a("el-tag",{attrs:{type:"warning"}},[e._v("维护")]):e._e()]}}])}),a("vxe-column",{attrs:{field:"serviceType",title:"服务类别",formatter:["formatSelect",e.serviceOptions],sortable:""}}),a("vxe-column",{attrs:{field:"loadBalancer",title:"负载均衡",formatter:["formatSelect",e.loadBalancerOptions],sortable:""}}),a("vxe-column",{attrs:{field:"weight",title:"权重",sortable:""}}),a("vxe-column",{attrs:{field:"configKey",title:"配置Key",sortable:""}}),a("vxe-column",{attrs:{field:"developer",title:"负责人",sortable:""}}),a("vxe-column",{attrs:{title:"操作",width:"200",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success"},on:{click:function(t){return t.preventDefault(),e.toConfig(n)}}},[e._v("配置")]),a("el-popconfirm",{attrs:{title:"确定要删除吗？"},on:{onConfirm:function(t){return e.remove(n)}}},[a("el-button",{attrs:{slot:"reference",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}])})],1)],1),a("template",{slot:"footer"},[a("el-pagination",{attrs:{"current-page":e.pageModel.pageIndex,"page-size":e.pageModel.pageSize,"page-sizes":[15,25,35,45],layout:"total, sizes, prev, pager, next, jumper",total:e.services.totalCount},on:{"size-change":e.sizeChange,"current-change":e.currentChange}})],1)],2)},r=[],i=(a("b0c0"),a("ac1f"),a("841c"),a("96cf"),a("1da1")),s={name:"service-detail",data:function(){return{loading:!1,services:[],pageModel:{pageSize:15,pageIndex:1,data:{name:"",serviceType:null,loadBalancer:null,status:null}},serviceOptions:[{value:0,label:"http"},{value:1,label:"grpc"}],statusOptions:[{value:0,label:"健康"},{value:1,label:"警告"},{value:2,label:"死亡"},{value:3,label:"维护"}],loadBalancerOptions:[{value:0,label:"轮询"},{value:1,label:"加权轮询"},{value:2,label:"最小连接数"}]}},mounted:function(){var e=this;this.Bus.on("serviceNameToDetail",(function(t){e.pageModel.data.name=t,e.search()}))},created:function(){this.search()},beforeDestroy:function(){this.Bus.off("serviceNameToDetail")},methods:{search:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$api.SERVICE_DETAIL(e.pageModel);case 3:e.services=t.sent,e.loading=!1;case 5:case"end":return t.stop()}}),t)})))()},toConfig:function(e){var t=this;this.$emit("show",1);var a=setTimeout((function(){t.Bus.emit("serviceNameToConfig",e.configKey),clearTimeout(a)}))},remove:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(2===e.status){a.next=3;break}return t.$message.error("仅能删除状态为“已死亡”的服务节点！"),a.abrupt("return");case 3:return a.next=5,t.$api.SERVICE_DELETE({serviceId:e.id});case 5:return n=a.sent,n?t.$message({type:"success",message:"删除成功！"}):t.$message.error("删除失败，请稍后重试！"),a.next=9,t.search();case 9:case"end":return a.stop()}}),a)})))()},sizeChange:function(e){this.pageModel.pageSize=e,this.search()},currentChange:function(e){this.pageModel.pageIndex=e,this.search()}}},o=s,l=a("2877"),c=Object(l["a"])(o,n,r,!1,null,"2bdf03f0",null);t["default"]=c.exports},ab13:function(e,t,a){var n=a("b622"),r=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(a){try{return t[r]=!1,"/./"[e](t)}catch(n){}}return!1}},d695:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("transition",{attrs:{name:"el-fade-in-linear"}},[a("keep-alive",{attrs:{include:"service-detail"}},[0===e.order?a("list",{on:{show:e.show}}):1===e.order?a("config",{on:{show:e.show}}):e._e()],1)],1)],1)},r=[],i=a("a816"),s=a("3efd"),o={name:"service",components:{list:i["default"],config:s["default"]},data:function(){return{order:0}},methods:{show:function(e){this.order=e}}},l=o,c=a("2877"),u=Object(c["a"])(l,n,r,!1,null,null,null);t["default"]=u.exports}}]);